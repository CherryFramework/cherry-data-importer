!function(t,e){"use strict";e={selectors:{trigger:"#cherry-import-start",upload:"#cherry-file-upload"},init:function(){t(function(){t("body").on("click",e.selectors.trigger,e.goToImport),window.CherryDataImportVars.autorun&&e.startImport(),e.fileUpload()})},ajaxRequest:function(r){r.nonce=window.CherryDataImportVars.nonce,t.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:r,error:function(){}}).done(function(r){!0!==r.success||r.data.import_end||e.ajaxRequest(r.data),r.data.complete&&t("progress").attr("value",r.data.complete)})},startImport:function(){var r=t(this),a={action:"cherry-data-import-chunk",chunk:1};r.attr("disabled","disabled"),e.ajaxRequest(a)},prepareImportArgs:function(){var e=null;return t('select[name="import_file"]').length&&(e=t('select[name="import_file"] option:selected').val()),"&step=2&file="+e},goToImport:function(){var r=t('input[name="referrer"]').val();window.location=r+e.prepareImportArgs()},fileUpload:function(){var r=t(e.selectors.upload),a=r.closest(".import-file"),o=a.find(".import-file__input"),n=wp.media.frames.file_frame=wp.media({title:CherryDataImportVars.uploadTitle,button:{text:CherryDataImportVars.uploadBtn},multiple:!1});r.on("click",function(){return n.open(),!1}),n.on("select",function(){var t=n.state().get("selection").toJSON(),r=t[0];o.val(r.url),e.getFilePath(r.url)})},getFilePath:function(r){var a=t(e.selectors.trigger);a.addClass("disabled"),t.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:{action:"cherry-data-import-get-file-path",file:r,nonce:window.CherryDataImportVars.nonce},error:function(){a.removeClass("disabled")}}).done(function(){a.removeClass("disabled")})}},e.init()}(jQuery,window.CherryDataImport);