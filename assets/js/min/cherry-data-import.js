!function(t,a){"use strict";a={selectors:{trigger:"#cherry-import-start",upload:"#cherry-file-upload",globalProgress:"#cherry-import-progress"},globalProgress:null,init:function(){t(function(){a.globalProgress=t(a.selectors.globalProgress).find(".cdi-progress__bar"),t("body").on("click",a.selectors.trigger,a.goToImport),window.CherryDataImportVars.autorun&&a.startImport(),a.fileUpload()})},ajaxRequest:function(e){e.nonce=window.CherryDataImportVars.nonce,e.file=window.CherryDataImportVars.file,t.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:e,error:function(){}}).done(function(e){!0!==e.success||e.data.import_end||a.ajaxRequest(e.data),e.data&&e.data.redirect&&(window.location=e.data.redirect),e.data&&e.data.complete&&a.globalProgress.css("width",e.data.complete+"%").find(".cdi-progress__label").text(e.data.complete+"%"),e.data&&e.data.processed&&t.each(e.data.processed,a.updateSummary)})},updateSummary:function(a,e){var r=t('tr[data-item="'+a+'"]'),o=parseInt(r.data("total")),n=t(".cdi-install-summary__done",r),i=t(".cdi-install-summary__percent",r),l=t(".cdi-progress__bar",r),s=Math.round(parseInt(e)/o*100);n.html(e),i.html(s),l.css("width",s+"%")},startImport:function(){var t={action:"cherry-data-import-chunk",chunk:1};a.ajaxRequest(t)},prepareImportArgs:function(){var a=null,e=t('input[name="upload_file"]'),r=t('select[name="import_file"]');return e.length&&""!==e.val()&&(a=e.val()),r.length&&null==a&&(a=t("option:selected",r).val()),"&tab="+window.CherryDataImportVars.tab+"&step=2&file="+a},goToImport:function(){var e=t('input[name="referrer"]').val();t(this).hasClass("disabled")||(window.location=e+a.prepareImportArgs())},fileUpload:function(){var e=t(a.selectors.upload),r=e.closest(".import-file"),o=r.find(".import-file__placeholder"),n=r.find(".import-file__input"),i=wp.media.frames.file_frame=wp.media({title:window.CherryDataImportVars.uploadTitle,button:{text:window.CherryDataImportVars.uploadBtn},multiple:!1}),l=function(){return i.open(),!1},s=function(){var t=i.state().get("selection").toJSON(),e=t[0];o.val(e.url),a.getFilePath(e.url,n)};e.on("click",l),i.on("select",s)},getFilePath:function(e,r){var o=t(a.selectors.trigger);o.addClass("disabled"),t.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:{action:"cherry-data-import-get-file-path",file:e,nonce:window.CherryDataImportVars.nonce},error:function(){return o.removeClass("disabled"),!1}}).done(function(t){o.removeClass("disabled"),!0===t.success&&r.val(t.data.path)})}},a.init()}(jQuery,window.CherryDataImport);