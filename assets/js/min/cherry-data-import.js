!function(e,t){"use strict";t={selectors:{trigger:"#cherry-import-start",upload:"#cherry-file-upload",globalProgress:"#cherry-import-progress"},globalProgress:null,init:function(){e(function(){t.globalProgress=e(t.selectors.globalProgress).find(".cdi-progress__bar"),e("body").on("click",t.selectors.trigger,t.goToImport),window.CherryDataImportVars.autorun&&t.startImport(),void 0!==window.CherryRegenerateData&&t.regenreateThumbnails(),t.fileUpload()})},regenreateThumbnails:function(){var e={action:"cherry-regenerate-thumbnails",offset:0,step:window.CherryRegenerateData.step,total:window.CherryRegenerateData.totalSteps};t.ajaxRequest(e)},ajaxRequest:function(a){var r;a.nonce=window.CherryDataImportVars.nonce,a.file=window.CherryDataImportVars.file,e.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:a,error:function(){a.step?(r=Math.ceil(100*(a.offset+a.step)/(a.total*a.step)),t.globalProgress.css("width",r+"%").find(".cdi-progress__label").text(r+"%"),a.offset=a.offset+a.step,t.ajaxRequest(a)):e("#cherry-import-progress").replaceWith('<div class="import-failed">'+window.CherryDataImportVars.error+"</div>")}}).done(function(a){!0!==a.success||a.data.isLast||t.ajaxRequest(a.data),a.data&&a.data.redirect&&(window.location=a.data.redirect),a.data&&a.data.complete&&(t.globalProgress.css("width",a.data.complete+"%").find(".cdi-progress__label").text(a.data.complete+"%"),t.globalProgress.siblings(".cdi-progress__placeholder").remove()),a.data&&a.data.processed&&e.each(a.data.processed,t.updateSummary)})},updateSummary:function(t,a){var r=e('tr[data-item="'+t+'"]'),o=parseInt(r.data("total")),s=e(".cdi-install-summary__done",r),i=e(".cdi-install-summary__percent",r),n=e(".cdi-progress__bar",r),l=Math.round(parseInt(a)/o*100);s.html(a),i.html(l),n.css("width",l+"%")},startImport:function(){var e={action:"cherry-data-import-chunk",chunk:1};t.ajaxRequest(e)},prepareImportArgs:function(){var t=null,a=e('input[name="upload_file"]'),r=e('select[name="import_file"]');return a.length&&""!==a.val()&&(t=a.val()),r.length&&null==t&&(t=e("option:selected",r).val()),"&tab="+window.CherryDataImportVars.tab+"&step=2&file="+t},goToImport:function(){var a=e('input[name="referrer"]').val();e(this).hasClass("disabled")||(window.location=a+t.prepareImportArgs())},fileUpload:function(){var a=e(t.selectors.upload),r=a.closest(".import-file"),o=r.find(".import-file__placeholder"),s=r.find(".import-file__input"),i=wp.media.frames.file_frame=wp.media({title:window.CherryDataImportVars.uploadTitle,button:{text:window.CherryDataImportVars.uploadBtn},multiple:!1}),n=function(){return i.open(),!1},l=function(){var e=i.state().get("selection").toJSON(),a=e[0];o.val(a.url),t.getFilePath(a.url,s)};a.on("click",n),i.on("select",l)},getFilePath:function(a,r){var o=e(t.selectors.trigger);o.addClass("disabled"),e.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:{action:"cherry-data-import-get-file-path",file:a,nonce:window.CherryDataImportVars.nonce},error:function(){return o.removeClass("disabled"),!1}}).done(function(e){o.removeClass("disabled"),!0===e.success&&r.val(e.data.path)})}},t.init()}(jQuery,window.CherryDataImport);