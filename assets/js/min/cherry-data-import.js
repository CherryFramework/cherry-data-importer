!function(t,e){"use strict";e={selectors:{trigger:"#cherry-import-start",upload:"#cherry-file-upload",globalProgress:"#cherry-import-progress"},globalProgress:null,init:function(){t(function(){e.globalProgress=t(e.selectors.globalProgress).find(".cdi-progress__bar"),t("body").on("click",e.selectors.trigger,e.goToImport),window.CherryDataImportVars.autorun&&e.startImport(),e.fileUpload()})},ajaxRequest:function(a){a.nonce=window.CherryDataImportVars.nonce,a.file=window.CherryDataImportVars.file,t.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:a,error:function(){}}).done(function(a){!0!==a.success||a.data.import_end||e.ajaxRequest(a.data),a.data&&a.data.redirect&&(window.location=a.data.redirect),a.data&&a.data.complete&&e.globalProgress.css("width",a.data.complete+"%").find(".cdi-progress__label").text(a.data.complete+"%"),a.data&&a.data.processed&&t.each(a.data.processed,e.updateSummary)})},updateSummary:function(e,a){var r=t('tr[data-item="'+e+'"]'),o=parseInt(r.data("total")),n=t(".cdi-install-summary__done",r),i=t(".cdi-install-summary__percent",r),l=t(".cdi-progress__bar",r),s=Math.round(parseInt(a)/o*100);n.html(a),i.html(s),l.css("width",s+"%")},startImport:function(){var t={action:"cherry-data-import-chunk",chunk:1};e.ajaxRequest(t)},prepareImportArgs:function(){var e=null,a=t('input[name="upload_file"]'),r=t('select[name="import_file"]');return a.length&&""!==a.val()&&(e=a.val()),r.length&&null==e&&(e=t("option:selected",r).val()),"&step=2&file="+e},goToImport:function(){var a=t('input[name="referrer"]').val();window.location=a+e.prepareImportArgs()},fileUpload:function(){var a=t(e.selectors.upload),r=a.closest(".import-file"),o=r.find(".import-file__placeholder"),n=r.find(".import-file__input"),i=wp.media.frames.file_frame=wp.media({title:CherryDataImportVars.uploadTitle,button:{text:CherryDataImportVars.uploadBtn},multiple:!1});a.on("click",function(){return i.open(),!1}),i.on("select",function(){var t=i.state().get("selection").toJSON(),a=t[0];o.val(a.url),e.getFilePath(a.url,n)})},getFilePath:function(a,r){var o=t(e.selectors.trigger);o.addClass("disabled"),t.ajax({url:window.ajaxurl,type:"get",dataType:"json",data:{action:"cherry-data-import-get-file-path",file:a,nonce:window.CherryDataImportVars.nonce},error:function(){return o.removeClass("disabled"),!1}}).done(function(t){o.removeClass("disabled"),!0===t.success&&r.val(t.data.path)})}},e.init()}(jQuery,window.CherryDataImport);